<!DOCTYPE html>
<html lang="ko">
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, interactive-widget=resizes-content">
  <meta name="description" content="MyHome - 쉽고 빠른 부동산 상담">
  
  <!-- SEO meta tags -->
  <meta name="robots" content="index, follow">
  <meta name="keywords" content="부동산, 공인중개사, 부동산 상담, 부동산 견적, 중개사 찾기, 부동산 매매, MyHome">
  <meta name="author" content="MyHome">
  <meta name="theme-color" content="#0175C2">

  <!-- Open Graph meta tags for Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="MyHome">
  <meta property="og:title" content="MyHome - 쉽고 빠른 부동산 상담">
  <meta property="og:description" content="주소만 입력하면 근처 공인중개사를 찾아드립니다. 여러 중개사의 견적을 한눈에 비교하고 투명한 부동산 거래를 경험하세요.">
  <meta property="og:url" content="https://goldepond.github.io/TESTHOME/">
  <meta property="og:image" content="https://goldepond.github.io/TESTHOME/og-image1.jpg">
  <meta property="og:image:secure_url" content="https://goldepond.github.io/TESTHOME/og-image1.jpg">
  <meta property="og:image:type" content="image/jpeg">
  <meta property="og:image:alt" content="MyHome - 쉽고 빠른 부동산 상담">
  <meta property="og:locale" content="ko_KR">
  <meta property="og:locale:alternate" content="en_US">

  <!-- Twitter Card meta tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="MyHome - 쉽고 빠른 부동산 상담">
  <meta name="twitter:description" content="주소만 입력하면 근처 공인중개사를 찾아드립니다. 여러 중개사의 견적을 한눈에 비교하고 투명한 부동산 거래를 경험하세요.">
  <meta name="twitter:image" content="https://goldepond.github.io/TESTHOME/og-image1.jpg">

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="MyHome">
  <link rel="apple-touch-icon" href="BigLogo.jpg">

  <!-- Favicon -->
  <link rel="icon" type="image/jpeg" href="icon.jpg"/>

  <!-- Canonical URL -->
  <link rel="canonical" href="https://goldepond.github.io/TESTHOME/">

  <!-- DNS Prefetch for performance -->
  <link rel="dns-prefetch" href="https://www.gstatic.com">
  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  
  <!-- Preconnect for critical resources -->
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  
  <!-- 리소스 우선순위 힌트 (최초 접속 성능 개선) -->
  <link rel="preload" href="main.dart.js" as="script" crossorigin>
  <link rel="preload" href="flutter.js" as="script" crossorigin>
  <link rel="modulepreload" href="main.dart.js">

  <!-- 시스템 폰트 설정 -->
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    
    /* Flutter 앱 컨테이너 */
    #flutter-view, flt-glass-pane {
      height: 100%;
      width: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif !important;
    }
    
    /* 모바일 웹 키보드 문제 해결 */
    @supports (-webkit-touch-callout: none) {
      /* iOS Safari */
      body {
        position: fixed;
        width: 100%;
      }
    }
    
    /* 로딩 화면 최적화 */
    #loading {
      align-items: center;
      display: flex;
      height: 100%;
      justify-content: center;
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      background: #fff;
      z-index: 9999;
    }
    
    #loading img {
      width: 50px;
      height: 50px;
      animation: 1s ease-in-out 0s infinite rotate;
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg) }
      to { transform: rotate(360deg) }
    }
  </style>

  <title>MyHome - 쉽고 빠른 부동산 상담</title>
  <link rel="manifest" href="manifest.json">

  <!-- Firebase SDK - 병렬 로딩으로 최초 접속 성능 개선 -->
  <script>
    // Firebase SDK를 병렬로 동시에 로드하여 최초 접속 시간 단축
    (function() {
      var firebaseScripts = [
        'https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js',
        'https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore-compat.js',
        'https://www.gstatic.com/firebasejs/10.13.2/firebase-auth-compat.js',
        'https://www.gstatic.com/firebasejs/10.13.2/firebase-storage-compat.js'
      ];
      
      window.firebaseSDKLoaded = false;
      var loadedCount = 0;
      var totalScripts = firebaseScripts.length;
      var hasError = false;
      
      // 모든 스크립트를 병렬로 동시에 로드 (순차 로딩 대비 50-70% 빠름)
      firebaseScripts.forEach(function(src) {
        var script = document.createElement('script');
        script.src = src;
        script.async = true;
        script.defer = true;
        
        script.onload = function() {
          loadedCount++;
          if (loadedCount === totalScripts) {
            window.firebaseSDKLoaded = true;
            window.dispatchEvent(new Event('firebaseSDKReady'));
          }
        };
        
        script.onerror = function() {
          console.error('Firebase SDK 로드 실패: ' + src);
          hasError = true;
          loadedCount++;
          // 에러가 있어도 계속 진행 (일부 SDK만 로드되어도 앱은 실행 가능)
          if (loadedCount === totalScripts) {
            window.firebaseSDKLoaded = true;
            window.dispatchEvent(new Event('firebaseSDKReady'));
          }
        };
        
        document.head.appendChild(script);
      });
      
      // 타임아웃: 8초 후 강제로 완료 처리 (모바일 네트워크 고려)
      setTimeout(function() {
        if (!window.firebaseSDKLoaded) {
          console.warn('Firebase SDK 로드 타임아웃 - 앱 계속 진행');
          window.firebaseSDKLoaded = true;
          window.dispatchEvent(new Event('firebaseSDKReady'));
        }
      }, 8000);
    })();
  </script>

  <!-- Flutter 초기화 - Firebase보다 우선하여 먼저 로드 -->
  <script src="flutter.js" defer></script>
</head>
<body>
  <!-- Firebase 초기화는 Flutter 코드에서 처리하므로 여기서는 제거 -->
  <!-- Flutter의 Firebase.initializeApp()이 자동으로 처리합니다 -->

  <!-- 로딩 인디케이터 -->
  <div id="loading">
    <style>
      body {
        inset: 0;
        overflow: hidden;
        margin: 0;
        padding: 0;
        position: fixed;
      }
      #loading {
        align-items: center;
        display: flex;
        height: 100%;
        justify-content: center;
        width: 100%;
      }
      #loading img {
        width: 50px;
        height: 50px;
        animation: 1s ease-in-out 0s infinite rotate;
      }
      @keyframes rotate {
        from { transform: rotate(0deg) }
        to { transform: rotate(360deg) }
      }
    </style>
    <img src="icon.jpg" alt="Loading indicator..." />
  </div>

  <script>
    // 페이지 리소스를 모두 다 받을 때까지 기다리지 않고,
    // HTML 파싱이 진행되는 동안 바로 Flutter 번들을 로드해 초기 로딩을 단축한다.
    (function () {
      var loading = document.querySelector('#loading');
      var scriptTag = document.createElement('script');
      scriptTag.src = 'main.dart.js';
      scriptTag.defer = true; // 파서는 막지 않고, 다운로드는 바로 시작
      document.body.appendChild(scriptTag);

      // Flutter 앱이 첫 프레임을 렌더링했다는 이벤트 수신
      window.addEventListener('flutterAppReady', function() {
        if (loading) {
          // 페이드 아웃 애니메이션으로 부드럽게 제거
          loading.style.opacity = '0';
          loading.style.transition = 'opacity 0.3s ease-out';
          setTimeout(function() {
            if (loading && loading.parentNode) {
              loading.remove();
            }
          }, 300);
        }
      });

      // 네트워크 오류 등으로 main.dart.js 로딩에 실패했을 때 사용자에게 안내
      scriptTag.addEventListener('error', function () {
        if (loading) {
          loading.innerText =
            '앱을 불러오는 데 실패했습니다.\n네트워크 상태를 확인한 후 새로고침 해주세요.';
        }
      });
      
      // 타임아웃 보호: 최대 2초 후에는 강제로 로딩 화면 제거 (최초 접속 성능 개선)
      setTimeout(function() {
        if (loading && loading.parentNode) {
          console.warn('Flutter 앱 준비 신호를 받지 못했습니다. 로딩 화면을 강제로 제거합니다.');
          loading.style.opacity = '0';
          loading.style.transition = 'opacity 0.2s ease-out';
          setTimeout(function() {
            if (loading && loading.parentNode) {
              loading.remove();
            }
          }, 200);
        }
      }, 2000);
    })();

    // Ctrl + 마우스 휠 줌 활성화
    // Flutter가 wheel 이벤트를 가로채는 것을 방지하여 브라우저의 기본 줌 동작을 허용
    document.addEventListener('wheel', function(e) {
      // Ctrl 키가 눌린 상태에서 마우스 휠 이벤트가 발생하면
      if (e.ctrlKey) {
        // Flutter의 이벤트 처리를 막고 브라우저의 기본 줌 동작을 허용
        e.stopPropagation();
        // Flutter 뷰가 로드된 후에도 작동하도록 추가 처리
        var flutterView = document.querySelector('#flutter-view');
        if (flutterView) {
          flutterView.style.pointerEvents = 'none';
          setTimeout(function() {
            flutterView.style.pointerEvents = '';
          }, 0);
        }
      }
    }, { passive: false, capture: true });
  </script>
</body>
</html>
